<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test YouTube API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #5568d3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin: 10px 0;
        }
        label {
            display: block;
            font-weight: bold;
            margin: 10px 0 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de YouTube API</h1>
        <p>Usa este script para verificar que tu API Key funciona correctamente.</p>
        
        <div class="test-section">
            <label>API Key:</label>
            <input type="text" id="apiKey" value="AIzaSyD4_1H8Zi1U9DAEkSrX9D1FtxLmcJR2vTM" placeholder="Pega tu API Key aqu√≠">
        </div>

        <div class="test-section">
            <label>Channel Handle (ejemplo: @entrenoapp) o Channel ID:</label>
            <input type="text" id="channelInput" placeholder="@tu_nombre o UCxxxxx">
            <button onclick="testAPI()">üîç Probar API Key</button>
            <button onclick="testChannel()">üé• Buscar Canal</button>
            <button onclick="testVideos()">üì∫ Buscar Videos</button>
            <div id="result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>üìã Instrucciones:</h3>
            <ol>
                <li>Haz clic en "üîç Probar API Key" primero</li>
                <li>Si funciona, pon tu @handle (ejemplo: @entrenoapp)</li>
                <li>Haz clic en "üé• Buscar Canal" para obtener el Channel ID</li>
                <li>Haz clic en "üì∫ Buscar Videos" para ver tus videos</li>
                <li>Copia los datos que aparezcan y √∫salos en youtube-gallery.html</li>
            </ol>
        </div>
    </div>

    <script>
        function showResult(text, isSuccess = true) {
            const result = document.getElementById('result');
            result.textContent = text;
            result.className = 'result ' + (isSuccess ? 'success' : 'error');
            result.style.display = 'block';
        }

        async function testAPI() {
            const apiKey = document.getElementById('apiKey').value;
            showResult('üîÑ Probando API Key...', true);
            
            try {
                const url = `https://www.googleapis.com/youtube/v3/activities?key=${apiKey}&part=snippet&channelId=UC-lHJZR3DtoQ_LoIvMm6Xk0&maxResults=1`;
                const response = await fetch(url);
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('‚úÖ API KEY FUNCIONA CORRECTAMENTE\n\n' +
                              'Ahora puedes usar esta API Key en tu configuraci√≥n.\n\n' +
                              JSON.stringify(data, null, 2), true);
                } else {
                    const error = await response.json();
                    showResult('‚ùå ERROR CON API KEY\n\n' +
                              'C√≥digo: ' + response.status + '\n' +
                              'Mensaje: ' + JSON.stringify(error, null, 2), false);
                }
            } catch (error) {
                showResult('‚ùå ERROR: ' + error.message, false);
            }
        }

        async function testChannel() {
            const apiKey = document.getElementById('apiKey').value;
            const channelInput = document.getElementById('channelInput').value.trim();
            
            if (!channelInput) {
                showResult('‚ö†Ô∏è Por favor ingresa un @handle o Channel ID', false);
                return;
            }
            
            showResult('üîÑ Buscando canal...', true);
            
            try {
                let url;
                
                if (channelInput.startsWith('UC')) {
                    // Es un Channel ID
                    url = `https://www.googleapis.com/youtube/v3/channels?key=${apiKey}&id=${channelInput}&part=snippet,contentDetails,statistics`;
                } else {
                    // Es un handle
                    const handle = channelInput.replace('@', '');
                    url = `https://www.googleapis.com/youtube/v3/search?key=${apiKey}&type=channel&q=${encodeURIComponent(handle)}&part=snippet&maxResults=1`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    const channel = data.items[0];
                    const channelId = channel.id?.channelId || channel.id;
                    
                    showResult('‚úÖ CANAL ENCONTRADO\n\n' +
                              'üì∫ Nombre: ' + (channel.snippet?.title || 'N/A') + '\n' +
                              'üÜî Channel ID: ' + channelId + '\n' +
                              'üìù Descripci√≥n: ' + (channel.snippet?.description?.substring(0, 100) || 'N/A') + '...\n' +
                              'üë• Suscriptores: ' + (channel.statistics?.subscriberCount || 'N/A') + '\n' +
                              'üé• Videos: ' + (channel.statistics?.videoCount || 'N/A') + '\n\n' +
                              'üëâ COPIA EL CHANNEL ID Y PONLO EN youtube-gallery.html:\n\n' +
                              'channelId: \'' + channelId + '\'',
                              true);
                } else {
                    showResult('‚ùå Canal no encontrado\n\n' +
                              'Verifica que:\n' +
                              '1. El @handle o Channel ID es correcto\n' +
                              '2. El canal es p√∫blico\n' +
                              '3. La API Key tiene acceso a YouTube Data API v3',
                              false);
                }
            } catch (error) {
                showResult('‚ùå ERROR: ' + error.message, false);
            }
        }

        async function testVideos() {
            const apiKey = document.getElementById('apiKey').value;
            const channelInput = document.getElementById('channelInput').value.trim();
            
            if (!channelInput) {
                showResult('‚ö†Ô∏è Primero busca tu canal con "Buscar Canal"', false);
                Connectivity
                return;
            }
            
            showResult('üîÑ Buscando videos del canal...', true);
            
            try {
                // Primero obtener el Channel ID si no lo tenemos
                let channelId;
                
                if (channelInput.startsWith('UC')) {
                    channelId = channelInput;
                } else {
                    const handle = channelInput.replace('@', '');
                    const searchUrl = `https://www.googleapis.com/youtube/v3/search?key=${apiKey}&type=channel&q=${encodeURIComponent(handle)}&part=snippet&maxResults=1`;
                    const searchResponse = await fetch(searchUrl);
                    const searchData = await searchResponse.json();
                    if (searchData.items && searchData.items.length > 0) {
                        channelId = searchData.items[0].id?.channelId || searchData.items[0].id;
                    } else {
                        showResult('‚ùå Canal no encontrado', false);
                        return;
                    }
                }
                
                // Buscar videos
                const url = `https://www.googleapis.com/youtube/v3/search?key=${apiKey}&channelId=${channelId}&part=snippet,id&order=date&maxResults=5`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    let result = '‚úÖ VIDEOS ENCONTRADOS\n\n';
                    
                    data.items.forEach((item, index) => {
                        const videoId = item.id?.videoId || item.id;
                        result += `${index + 1}. ${item.snippet?.title}\n`;
                        result += `   ID: ${videoId}\n`;
                        result += `   URL: https://youtube.com/watch?v=${videoId}\n\n`;
                    });
                    
                    result += 'üëâ COPIA LOS IDs Y PONLOS EN featuredVideos:\n\n';
                    result += 'featuredVideos: [\n';
                    data.items.forEach(item => {
                        const videoId = item.id?.videoId || item.id;
                        result += `    '${videoId}',\n`;
                    });
                    result += ']';
                    
                    showResult(result, true);
                } else {
                    showResult('‚ö†Ô∏è No se encontraron videos\n\n' +
                              'Verifica que el canal tenga videos p√∫blicos',
                              false);
                }
            } catch (error) {
                showResult('‚ùå ERROR: ' + error.message, false);
            }
        }
    </script>
</body>
</html>
